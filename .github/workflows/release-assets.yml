name: Create Release Zip Assets

on:
  release:
    types: [published]

jobs:
  build-release-assets:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Debug - Show repository structure
        run: |
          echo "=== Repository root contents ==="
          ls -la
          echo ""
          echo "=== Full directory tree ==="
          find . -type d -name ".git" -prune -o -type d -print | head -50
      
      - name: Create zip files for specific folders
        run: |
          # Create a directory for zip files
          mkdir -p release-zips
          
          # Define the specific folders to zip (use full paths from repo root)
          # Format: "path/to/folder:OutputName" or just "path/to/folder" to use folder name
          folders=(
            "LowRider CNC/Jackpot3/JP3_LR"
            "LowRider CNC/Jackpot2/JP2_LR"
            "LowRider CNC/Jackpot/JP1_LR"
            "MPCNC/Jackpot3/JP3_MPCNC"
            "MPCNC/Jackpot2/JP2_MPCNC"
            "MPCNC/Jackpot/JP1_MPCNC"
          )
          
          # Loop through the specified folders
          for folder_spec in "${folders[@]}"; do
            # Check if custom output name is specified
            if [[ "$folder_spec" == *":"* ]]; then
              folder_path="${folder_spec%%:*}"
              output_name="${folder_spec##*:}"
            else
              folder_path="$folder_spec"
              # Use the last part of the path as the output name
              output_name=$(basename "$folder_path")
            fi
            
            if [ -d "$folder_path" ]; then
              echo "Creating zip for: $folder_path -> ${output_name}.zip"
              # Change to the folder and zip its contents using absolute path
              (cd "$folder_path" && zip -r "$RELEASE_DIR/${output_name// /_}.zip" .)
            else
              echo "Warning: Directory '$folder_path' not found, skipping..."
            fi
          done
          
          # List created zip files
          ls -lh "$RELEASE_DIR"
      
      - name: Upload zip files to release
        uses: softprops/action-gh-release@v1
        with:
          files: release-zips/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
