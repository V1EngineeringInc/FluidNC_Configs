name: Create Release Zip Assets

on:
  release:
    types: [published]

jobs:
  build-release-assets:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Create zip files for specific folders
        run: |
          # Create a directory for zip files (absolute path)
          RELEASE_DIR="${GITHUB_WORKSPACE}/release-zips"
          mkdir -p "$RELEASE_DIR"
          echo "Release directory: $RELEASE_DIR"
          
          # Define the specific folders to zip
          # Format: "path/to/folder:OutputZipName" or just "path/to/folder" to use folder name
          # Each folder will be zipped with only its contents (no parent folder structure)
          folders=(
            "LowRider CNC/Jackpot3/JP3_LR"
            "LowRider CNC/Jackpot2/JP2_LR"
            "LowRider CNC/Jackpot/JP1_LR"
            "MPCNC/Jackpot3/JP3_MPCNC"
            "MPCNC/Jackpot2/JP2_MPCNC"
            "MPCNC/Jackpot/JP1_MPCNC"
          )
          
          # Loop through each specified folder
          for folder_spec in "${folders[@]}"; do
            # Check if custom output name is specified with colon
            if [[ "$folder_spec" == *":"* ]]; then
              folder_path="${folder_spec%%:*}"
              output_name="${folder_spec##*:}"
            else
              folder_path="$folder_spec"
              # Use the last part of the path as the output name
              output_name=$(basename "$folder_path")
            fi
            
            # Check if directory exists
            if [ -d "$folder_path" ]; then
              echo "Creating zip for: $folder_path -> ${output_name}.zip"
              # Save current directory
              CURRENT_DIR=$(pwd)
              # Change into the folder and zip all contents (files only, no parent folders)
              cd "$folder_path"
              zip -r "$RELEASE_DIR/${output_name// /_}.zip" .
              # Return to original directory
              cd "$CURRENT_DIR"
            else
              echo "Warning: Directory '$folder_path' not found, skipping..."
            fi
          done
          
          # List all created zip files
          echo ""
          echo "=== Created zip files ==="
          ls -lh "$RELEASE_DIR"
      
      - name: Upload zip files to release
        uses: softprops/action-gh-release@v1
        with:
          files: release-zips/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
